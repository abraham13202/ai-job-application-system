<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Application Manager - AI-Powered Career Tools</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --primary-light: #3b82f6;
            --secondary: #64748b;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --bg-tertiary: #f1f5f9;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-tertiary: #94a3b8;
            --border: #e2e8f0;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-secondary);
            color: var(--text-primary);
            line-height: 1.6;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            color: white;
            padding: 2rem 0;
            box-shadow: var(--shadow-lg);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .header h1 {
            font-size: 1.875rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            letter-spacing: -0.025em;
        }

        .header p {
            font-size: 1rem;
            color: #cbd5e1;
            font-weight: 400;
        }

        /* Main Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Card Component */
        .card {
            background: var(--bg-primary);
            border-radius: 12px;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border);
            overflow: hidden;
        }

        .card-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
            background: var(--bg-tertiary);
        }

        .card-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .card-body {
            padding: 1.5rem;
        }

        /* Search Panel */
        .search-panel {
            margin-bottom: 2rem;
        }

        .form-grid {
            display: grid;
            gap: 1.5rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-label {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-primary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .form-input,
        .form-select,
        .form-textarea {
            padding: 0.75rem 1rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 0.9375rem;
            font-family: inherit;
            transition: all 0.2s;
            background: var(--bg-primary);
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
            font-family: 'Inter', monospace;
        }

        .form-hint {
            font-size: 0.8125rem;
            color: var(--text-tertiary);
            margin-top: -0.25rem;
        }

        /* Checkbox Group */
        .checkbox-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 0.75rem;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            background: var(--bg-primary);
        }

        .checkbox-label:hover {
            border-color: var(--primary);
            background: var(--bg-tertiary);
        }

        .checkbox-label input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .checkbox-label span {
            font-size: 0.9375rem;
            font-weight: 500;
        }

        /* Buttons */
        .button-group {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
            margin-top: 1.5rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 0.9375rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-family: inherit;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover:not(:disabled) {
            background: var(--border);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover:not(:disabled) {
            background: #dc2626;
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Progress Bar */
        .progress-container {
            display: none;
            margin-top: 1.5rem;
            padding: 1.5rem;
            background: var(--bg-tertiary);
            border-radius: 8px;
            border: 1px solid var(--border);
        }

        .progress-container.active {
            display: block;
        }

        .progress-bar {
            height: 8px;
            background: var(--border);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 0.75rem;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
            transition: width 0.3s ease;
            border-radius: 4px;
        }

        .progress-message {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--bg-primary);
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid var(--border);
            box-shadow: var(--shadow-sm);
        }

        .stat-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
        }

        /* Jobs Grid */
        .jobs-grid {
            display: grid;
            gap: 1.5rem;
        }

        .job-card {
            background: var(--bg-primary);
            border-radius: 12px;
            border: 1px solid var(--border);
            padding: 1.5rem;
            transition: all 0.2s;
            cursor: pointer;
        }

        .job-card:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

        .job-card-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1rem;
        }

        .job-info-main {
            flex: 1;
        }

        .job-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .job-company {
            font-size: 1rem;
            color: var(--primary);
            font-weight: 500;
            margin-bottom: 0.25rem;
        }

        .job-location {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .priority-badge {
            padding: 0.375rem 0.75rem;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .priority-high {
            background: #fef3c7;
            color: #92400e;
        }

        .priority-medium {
            background: #dbeafe;
            color: #1e40af;
        }

        .priority-low {
            background: var(--bg-tertiary);
            color: var(--text-secondary);
        }

        .job-tags {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
            margin: 1rem 0;
        }

        .job-tag {
            padding: 0.375rem 0.75rem;
            background: var(--bg-tertiary);
            border-radius: 6px;
            font-size: 0.8125rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .job-actions {
            display: flex;
            gap: 0.75rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }

        /* Loading State */
        .loading {
            text-align: center;
            padding: 3rem;
            color: var(--text-secondary);
        }

        .loading-spinner {
            border: 3px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 1000;
            padding: 2rem;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--bg-primary);
            border-radius: 12px;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            box-shadow: var(--shadow-xl);
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 0.25rem 0.5rem;
            line-height: 1;
        }

        .modal-close:hover {
            color: var(--text-primary);
        }

        .modal-body {
            padding: 1.5rem;
            overflow-y: auto;
            flex: 1;
        }

        .modal-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid var(--border);
        }

        .modal-tab {
            padding: 0.75rem 1.5rem;
            border: none;
            background: none;
            color: var(--text-secondary);
            font-weight: 500;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
            transition: all 0.2s;
        }

        .modal-tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .modal-tab-content {
            display: none;
        }

        .modal-tab-content.active {
            display: block;
        }

        .document-content {
            background: var(--bg-tertiary);
            padding: 1.5rem;
            border-radius: 8px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            line-height: 1.6;
            color: var(--text-primary);
            max-height: 60vh;
            overflow-y: auto;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.5rem;
            }

            .container {
                padding: 1rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .button-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }

            .modal {
                padding: 0;
            }

            .modal-content {
                max-height: 100vh;
                border-radius: 0;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <h1>Job Application Manager</h1>
            <p>AI-powered tools to streamline your job search and application process</p>
        </div>
    </div>

    <div class="container">
        <!-- Search Panel -->
        <div class="card search-panel">
            <div class="card-header">
                <h2 class="card-title">Search for Jobs</h2>
            </div>
            <div class="card-body">
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Search Keywords</label>
                        <textarea id="keywords" class="form-textarea" placeholder="Enter job titles or keywords (one per line)&#10;Example:&#10;Data Scientist&#10;Software Engineer&#10;Product Manager"></textarea>
                        <p class="form-hint">Enter each search term on a new line for more targeted results</p>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
                        <div class="form-group">
                            <label class="form-label">Country</label>
                            <select id="country" class="form-select" onchange="updatePlatforms()">
                                <option value="australia">Australia</option>
                                <option value="usa">United States</option>
                                <option value="uk">United Kingdom</option>
                                <option value="india">India</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Location</label>
                            <input type="text" id="location" class="form-input" value="Sydney" placeholder="City or region">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Job Platforms</label>
                        <div class="checkbox-grid" id="platformsGroup">
                            <label class="checkbox-label">
                                <input type="checkbox" class="platform-checkbox" data-platform="seek" checked>
                                <span>Seek</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" class="platform-checkbox" data-platform="indeed" checked>
                                <span>Indeed</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" class="platform-checkbox" data-platform="linkedin" checked>
                                <span>LinkedIn</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="clear-old">
                            <span>Clear previous results before searching</span>
                        </label>
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn btn-primary" id="searchBtn" onclick="startSearch()">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                        </svg>
                        Search Jobs
                    </button>
                    <button class="btn btn-secondary" onclick="location.reload()">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"/>
                            <path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"/>
                        </svg>
                        Refresh
                    </button>
                    <button class="btn btn-danger" onclick="clearAllJobs()">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                            <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
                        </svg>
                        Clear All Jobs
                    </button>
                </div>

                <div class="progress-container" id="progressContainer">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                    </div>
                    <div class="progress-message" id="progressMessage">Initializing search...</div>
                </div>
            </div>
        </div>

        <!-- Stats -->
        <div class="stats-grid" id="stats">
            <div class="stat-card">
                <div class="stat-label">Total Jobs</div>
                <div class="stat-value" id="totalJobs">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Ready to Apply</div>
                <div class="stat-value" id="readyJobs">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">High Priority</div>
                <div class="stat-value" id="highPriority">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Avg Match Score</div>
                <div class="stat-value" id="avgMatch">0%</div>
            </div>
        </div>

        <!-- Jobs Grid -->
        <div class="jobs-grid" id="jobsGrid">
            <div class="loading">
                <div class="loading-spinner"></div>
                <p>Loading jobs...</p>
            </div>
        </div>
    </div>

    <!-- Modal for viewing application details -->
    <div class="modal" id="applicationModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Application Details</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-tabs">
                    <button class="modal-tab active" onclick="switchTab('resume')">Resume</button>
                    <button class="modal-tab" onclick="switchTab('cover')">Cover Letter</button>
                </div>
                <div class="modal-tab-content active" id="resumeContent">
                    <div class="document-content" id="resumeText">Loading...</div>
                </div>
                <div class="modal-tab-content" id="coverContent">
                    <div class="document-content" id="coverText">Loading...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let searchInterval = null;

        // Country-specific platforms
        const countryPlatforms = {
            australia: [
                { id: 'seek', name: 'Seek', default: true },
                { id: 'indeed', name: 'Indeed', default: true },
                { id: 'linkedin', name: 'LinkedIn', default: true }
            ],
            usa: [
                { id: 'indeed', name: 'Indeed', default: true },
                { id: 'linkedin', name: 'LinkedIn', default: true },
                { id: 'glassdoor', name: 'Glassdoor', default: false },
                { id: 'monster', name: 'Monster', default: false }
            ],
            uk: [
                { id: 'indeed', name: 'Indeed', default: true },
                { id: 'linkedin', name: 'LinkedIn', default: true },
                { id: 'reed', name: 'Reed', default: true },
                { id: 'totaljobs', name: 'TotalJobs', default: false }
            ],
            india: [
                { id: 'naukri', name: 'Naukri', default: true },
                { id: 'linkedin', name: 'LinkedIn', default: true },
                { id: 'indeed', name: 'Indeed', default: true },
                { id: 'foundit', name: 'Foundit', default: false }
            ]
        };

        const defaultLocations = {
            australia: 'Sydney',
            usa: 'New York',
            uk: 'London',
            india: 'Bangalore'
        };

        function updatePlatforms() {
            const country = document.getElementById('country').value;
            const platformsGroup = document.getElementById('platformsGroup');
            const platforms = countryPlatforms[country];

            const locationInput = document.getElementById('location');
            locationInput.value = defaultLocations[country];

            platformsGroup.innerHTML = platforms.map(platform => `
                <label class="checkbox-label">
                    <input type="checkbox" class="platform-checkbox" data-platform="${platform.id}" ${platform.default ? 'checked' : ''}>
                    <span>${platform.name}</span>
                </label>
            `).join('');
        }

        async function startSearch() {
            const keywords = document.getElementById('keywords').value
                .split('\n')
                .map(k => k.trim())
                .filter(k => k.length > 0);

            if (keywords.length === 0) {
                alert('Please enter at least one keyword');
                return;
            }

            const location = document.getElementById('location').value;
            const country = document.getElementById('country').value;

            const platforms = [];
            document.querySelectorAll('.platform-checkbox:checked').forEach(checkbox => {
                platforms.push(checkbox.dataset.platform);
            });

            if (platforms.length === 0) {
                alert('Please select at least one platform');
                return;
            }

            const clearOld = document.getElementById('clear-old').checked;

            const searchBtn = document.getElementById('searchBtn');
            searchBtn.disabled = true;
            searchBtn.innerHTML = `
                <div class="loading-spinner" style="width: 16px; height: 16px; border-width: 2px;"></div>
                Searching...
            `;

            document.getElementById('progressContainer').classList.add('active');

            try {
                const response = await fetch('/api/search_jobs', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        keywords,
                        location,
                        country,
                        platforms,
                        clear_old: clearOld
                    })
                });

                const result = await response.json();

                if (result.success) {
                    searchInterval = setInterval(checkSearchStatus, 1000);
                } else {
                    alert('Error: ' + result.error);
                    resetSearch();
                }
            } catch (error) {
                alert('Error starting search: ' + error);
                resetSearch();
            }
        }

        async function checkSearchStatus() {
            try {
                const response = await fetch('/api/search_status');
                const status = await response.json();

                document.getElementById('progressFill').style.width = status.progress + '%';
                document.getElementById('progressMessage').textContent = status.message;

                if (!status.running && status.progress === 100) {
                    clearInterval(searchInterval);
                    setTimeout(() => {
                        resetSearch();
                        loadJobs();
                    }, 2000);
                }
            } catch (error) {
                console.error('Error checking status:', error);
            }
        }

        function resetSearch() {
            const searchBtn = document.getElementById('searchBtn');
            searchBtn.disabled = false;
            searchBtn.innerHTML = `
                <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                </svg>
                Search Jobs
            `;
            document.getElementById('progressContainer').classList.remove('active');
            document.getElementById('progressFill').style.width = '0%';
        }

        async function loadJobs() {
            try {
                const response = await fetch('/api/applications');
                const jobs = await response.json();

                document.getElementById('totalJobs').textContent = jobs.length;
                document.getElementById('readyJobs').textContent =
                    jobs.filter(j => j.status === 'Ready to Apply').length;
                document.getElementById('highPriority').textContent =
                    jobs.filter(j => j.priority_score >= 50).length;

                const avgMatch = jobs.length > 0
                    ? (jobs.reduce((sum, j) => sum + parseFloat(j.skill_match || 0), 0) / jobs.length).toFixed(1)
                    : 0;
                document.getElementById('avgMatch').textContent = avgMatch + '%';

                const grid = document.getElementById('jobsGrid');
                if (jobs.length === 0) {
                    grid.innerHTML = `
                        <div class="loading">
                            <p>No jobs found. Use the search panel above to find opportunities!</p>
                        </div>
                    `;
                    return;
                }

                grid.innerHTML = jobs.map(job => {
                    const priorityClass = job.priority_score >= 50 ? 'high' :
                                         job.priority_score >= 20 ? 'medium' : 'low';

                    return `
                        <div class="job-card">
                            <div class="job-card-header">
                                <div class="job-info-main">
                                    <div class="job-title">${job.job_title}</div>
                                    <div class="job-company">${job.company}</div>
                                    <div class="job-location">${job.location}</div>
                                </div>
                                <span class="priority-badge priority-${priorityClass}">
                                    Priority ${job.priority_score}
                                </span>
                            </div>
                            <div class="job-tags">
                                <span class="job-tag">Match: ${job.skill_match}</span>
                                <span class="job-tag">Source: ${job.source}</span>
                                <span class="job-tag">${job.status}</span>
                            </div>
                            <div class="job-actions">
                                <button class="btn btn-primary btn-sm" onclick="window.open('${job.url}', '_blank')">
                                    View Listing
                                </button>
                                <button class="btn btn-secondary btn-sm" onclick="viewDetails('${job.folder}')">
                                    View Application
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');

            } catch (error) {
                console.error('Error loading jobs:', error);
                document.getElementById('jobsGrid').innerHTML =
                    '<div class="loading"><p>Error loading jobs</p></div>';
            }
        }

        async function viewDetails(folder) {
            try {
                const response = await fetch(`/api/application/${folder}`);
                const data = await response.json();

                if (data.error) {
                    alert('Error loading application: ' + data.error);
                    return;
                }

                document.getElementById('modalTitle').textContent = data.info.job_title;
                document.getElementById('resumeText').textContent = data.resume || 'No resume available';
                document.getElementById('coverText').textContent = data.cover_letter || 'No cover letter available';

                document.getElementById('applicationModal').classList.add('active');
            } catch (error) {
                alert('Error loading application details: ' + error);
            }
        }

        function closeModal() {
            document.getElementById('applicationModal').classList.remove('active');
        }

        function switchTab(tab) {
            // Update tab buttons
            document.querySelectorAll('.modal-tab').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // Update tab content
            document.querySelectorAll('.modal-tab-content').forEach(content => {
                content.classList.remove('active');
            });

            if (tab === 'resume') {
                document.getElementById('resumeContent').classList.add('active');
            } else {
                document.getElementById('coverContent').classList.add('active');
            }
        }

        // Close modal on escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeModal();
            }
        });

        // Close modal when clicking outside
        document.getElementById('applicationModal').addEventListener('click', (e) => {
            if (e.target.id === 'applicationModal') {
                closeModal();
            }
        });

        async function clearAllJobs() {
            if (!confirm('Are you sure you want to delete all saved jobs?\n\nThis action cannot be undone.')) {
                return;
            }

            try {
                const response = await fetch('/api/clear_jobs', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'}
                });

                const result = await response.json();

                if (result.success) {
                    alert('All jobs cleared successfully!');
                    loadJobs();
                } else {
                    alert('Error: ' + result.error);
                }
            } catch (error) {
                alert('Error clearing jobs: ' + error);
            }
        }

        loadJobs();
    </script>
</body>
</html>
